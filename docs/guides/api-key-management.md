# API 金鑰管理使用

**版本：** 1.0

**適用對象：** 系統管理員、專案負責人

---

## 目錄

1. [功能概述](#功能概述)
2. [功能簡介](#功能簡介)
3. [如何新增 API 金鑰](#如何新增-api-金鑰)
4. [如何管理 API 金鑰](#如何管理-api-金鑰)
5. [安全性注意事項](#安全性注意事項)
6. [常見問題](#常見問題)

---

## 功能概述

API 金鑰管理可以集中 API 存取機制,可以為不同的應用程式或服務建立、管理和撤銷不需要的 API 金鑰。

### 主要功能

- **專案範圍控制**:每個 API 金鑰可存取一個或多個專案
- **一次性金鑰顯示**:金鑰僅在建立時顯示一次,確保安全
- **即時管理**:支援編輯專案範圍、撤銷金鑰等
- **活動追蹤**:記錄金鑰最後使用時間

---

## 功能簡介

### 金鑰列表頁面

登入進入[智能助理](https://web.i-daka.com/api-keys)後,可以在上方導覽列表-使用者- **API 金鑰管理** 頁面看到:

- **啟用中金鑰數量**:顯示目前有效的金鑰總數
- **總金鑰數量**:包含已撤銷的所有金鑰
- **金鑰詳細資訊**:
  - 金鑰名稱
  - 狀態(啟用中 / 已撤銷)
  - 使用者名稱(選填)
  - 建立時間
  - 綁定專案
  - 最後使用時間

---

## 如何新增 API 金鑰

### 步驟 1:開啟建立對話框

1. 登入系統後,前往至 **API 金鑰管理** 頁面
2. 點擊右上角的 **「新增金鑰」** 按鈕

### 步驟 2:填寫金鑰資訊

在跳出的對話框中,請填寫以下資訊:

#### 必填欄位

| 欄位名稱     | 說明                                      | 範例                             |
|----------|-----------------------------------------|--------------------------------|
| **金鑰名稱** | 為這個金鑰取一個有意義的名稱,方便日後識別 | `生產環境 API 金鑰`、`測試用金鑰` |
| **專案範圍** | 至少選擇一個此金鑰可以存取的專案          | `PROJ001 - 主要專案`             |

#### 選填欄位

| 欄位名稱       | 說明                         | 範例                         |
|--------------|----------------------------|----------------------------|
| **使用者名稱** | 記錄此金鑰的使用者或服務名稱 | `前端應用`、`資料分析服務`    |
| **描述**       | 金鑰的用途說明或其他備註     | `用於生產環境的前端應用程式` |

### 步驟 3:選擇專案範圍

1. 在 **「專案範圍」** 區域,您會看到您有權限的所有專案列表
2. 勾選一個或多個專案(可複選)
3. 畫面下方會顯示已選擇的專案數量

> **提示**:您只能選擇您有存取權限的專案

### 步驟 4:建立金鑰

1. 確認所有資訊填寫正確後,點擊 **「建立金鑰」** 按鈕
2. 系統會處理您的請求(按鈕會顯示「建立中...」)

### 步驟 5:保存金鑰(重要!)

建立成功後,系統會跳出一個對話框顯示您的 API 金鑰:

```
⚠️ 此金鑰僅顯示一次,請立即複製保存。

idaka_xxxxxxxxxxxxxxxxxxxxxxxxxxxx
```

**請務必執行以下操作:**

1. **方式一(推薦)**:點擊 **「複製到剪貼簿」** 按鈕
   - 系統會自動將金鑰複製到剪貼簿
   - 會看到「已複製」的確認訊息

2. **方式二**:手動複製金鑰文字

3. **立即保存**金鑰到安全的位置(如密碼管理器、環境變數檔案等)

> ⚠️ **重要安全提醒**
>
> - 此金鑰**只會顯示一次**,關閉對話框後將無法再次查看
> - 如果遺失金鑰,您需要撤銷舊金鑰並建立新的金鑰
> - 請勿將金鑰存放在程式碼庫或公開場所

### 步驟 6:完成

點擊 **「完成」** 或 **「關閉」**,新的金鑰會出現在金鑰列表中,狀態顯示為「啟用中」。

---

## 如何管理 API 金鑰

### 查看金鑰狀態

在金鑰列表中,每個金鑰會顯示以下狀態資訊:

- **啟用中** 🟡:金鑰正常可用
- **已撤銷** 🔴:金鑰已失效,無法使用

### 編輯專案範圍

如果需要修改金鑰可存取的專案:

1. 找到目標金鑰
2. 點擊該金鑰右側的 **「⋮」** 選單按鈕
3. 選擇 **「編輯綁定」**
4. 在跳出的對話框中:
   - 勾選或取消勾選專案
   - 查看已選擇的專案數量
5. 點擊 **「儲存變更」** 確認

> **注意**:修改會立即生效,使用此金鑰的應用程式將立即獲得或失去對應專案的存取權限

### 撤銷金鑰

當金鑰不再需要或疑似洩漏時,應立即撤銷:

1. 找到要撤銷的金鑰
2. 點擊該金鑰右側的 **「⋮」** 選單按鈕
3. 選擇 **「撤銷金鑰」**
4. 系統會顯示確認對話框,包含:
   - 金鑰名稱
   - 使用者名稱
   - ⚠️ 警告訊息:「撤銷後此金鑰將立即失效,且無法復原」
5. 確認後點擊 **「撤銷」** 按鈕

> ⚠️ **重要提醒**
>
> - 撤銷操作**無法復原**
> - 金鑰撤銷後會**立即失效**
> - 所有使用此金鑰的請求都會被拒絕
> - 撤銷後的金鑰仍會保留在列表中,但狀態會變為「已撤銷」

---

## 安全性注意事項

### 金鑰保護

1. **永不公開金鑰**
   - 不要將金鑰提交到 Git 版本控制
   - 使用環境變數或密鑰管理服務儲存

2. **最小權限原則**
   - 只授予金鑰必要的專案存取權限
   - 不同用途使用不同的金鑰

3. **定期輪換**
   - 定期更換長期使用的金鑰
   - 撤銷不再使用的舊金鑰

### 發現金鑰洩漏時的處理流程

如果懷疑金鑰已洩漏:

1. **立即撤銷**該金鑰
2. **建立新金鑰**取代
3. **更新**所有使用該金鑰的應用程式
4. **檢查**是否有異常的 API 使用記錄

---

## 常見問題

### Q1:我忘記複製金鑰了,怎麼辦?

**A**:基於安全考量,金鑰僅在建立時顯示一次。如果您忘記複製,請執行以下步驟:

1. 撤銷該金鑰
2. 建立新的金鑰
3. 這次請務必立即複製並保存

### Q2:一個金鑰可以綁定多個專案嗎?

**A**:可以。在建立或編輯金鑰時,您可以選擇多個專案。金鑰將能夠存取所有已選擇的專案。

### Q3:如何查看金鑰是否正在被使用?

**A**:在金鑰列表中,「最近活動」欄位會顯示金鑰最後一次被使用的時間。如果顯示「尚未使用」,表示該金鑰從未被呼叫過。

### Q4:撤銷金鑰後可以恢復嗎?

**A**:不可以。撤銷操作是不可逆的。如果誤撤銷,需要建立新的金鑰。

### Q5:我可以修改金鑰的名稱嗎?

**A**:目前不支援修改金鑰名稱。如果需要更改,建議:

1. 建立新的金鑰(使用正確的名稱)
2. 更新應用程式使用新金鑰
3. 撤銷舊金鑰

### Q6:為什麼我看不到某些專案?

**A**:專案範圍列表只會顯示登入帳戶有存取權限的專案。如果需要存取其他專案,請聯繫 iDaka 窗口調整權限。

### Q7:金鑰有效期限是多久?

**A**:金鑰沒有自動過期時間,除非被手動撤銷,否則將持續有效。建議定期輪換金鑰以提升安全性。

### Q8:如何在程式中使用 API 金鑰?

**A**:在 API 請求中,將金鑰加入 HTTP Header:

```http
X-API-Key: idaka_xxxxxxxxxxxxxxxxxxxxxxxxxxxx
```

或根據 [資料整合 API 文件](https://data-api.i-daka.com/docs/static/index.html)的要求使用其他認證方式。具體使用方法請參考 API 技術文件。
